<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Academic Profile | National Tertiary Student Portal</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* PROFILE SPECIFIC STYLES */
        .profile-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .profile-header-card {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
            position: relative;
        }

        .avatar-wrapper {
            position: relative;
            width: 140px;
            height: 140px;
        }

        .profile-img {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--bg-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background: #e2e8f0;
        }

        .edit-avatar-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--primary-color);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: 0.2s;
        }
        .edit-avatar-btn:hover { transform: scale(1.1); }

        .profile-info h1 {
            margin: 0 0 5px 0;
            font-size: 1.8rem;
            color: var(--text-color);
        }

        .profile-info p {
            margin: 0 0 15px 0;
            color: var(--text-muted);
        }

        .badge {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* FORM GRID */
        .form-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-color);
            font-family: inherit;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        /* CROPPER MODAL */
        #cropper-modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        .img-container {
            max-height: 400px;
            overflow: hidden;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">üá¨üá≠ Student Portal</div>
        <ul class="sidebar-links">
            <li><a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
            <li class="active"><a href="profile.html"><i class="fas fa-user"></i> My Profile</a></li>
            <li><a href="courses.html"><i class="fas fa-book-open"></i> Course Reg</a></li>
            <li><a href="connect.html"><i class="fas fa-comments"></i> Student Connect</a></li>
            <li><a href="library.html"><i class="fas fa-book"></i> National Library</a></li>
        </ul>
        <div class="sidebar-footer">
            <a href="index.html" style="color: #ef4444;"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </div>

    <div class="main-content" style="margin-left: 280px; padding: 20px;">
        
        <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div>
                <h2 style="color: var(--text-color);">My Academic Profile</h2>
                <p style="color: var(--text-muted);">Manage your personal and academic details.</p>
            </div>
            
            <div class="theme-wrapper">
                <select id="theme-selector" class="theme-select" onchange="setTheme(this.value)">
                    <option value="system">üíª System</option>
                    <option value="light">‚òÄÔ∏è Light</option>
                    <option value="dark">üåô Dark</option>
                    <option value="custom">üé® Custom</option>
                </select>
                <input type="color" id="custom-theme-picker" oninput="updateCustomColor(this.value)" style="display: none;">
            </div>
        </header>

        <div class="profile-container" id="printable-area">
            
            <div class="profile-header-card">
                <div class="avatar-wrapper">
                    <img id="profile-display" src="https://via.placeholder.com/150" alt="Profile" class="profile-img">
                    
                    <label for="img-input" class="edit-avatar-btn" title="Change Photo">
                        <i class="fas fa-camera"></i>
                    </label>
                    <input type="file" id="img-input" style="display:none" accept="image/*">
                </div>
                
                <div class="profile-info">
                    <h1 id="student-name">Student Name</h1>
                    <p id="student-email">student@gmail.com</p>
                    <span class="badge" id="student-role">UNDERGRADUATE STUDENT</span>
                </div>
            </div>

            <div class="form-section">
                <h3><i class="fas fa-user-graduate"></i> Academic Records</h3>
                
                <form id="profile-form" onsubmit="event.preventDefault(); saveProfile();">
                    <div class="form-grid">
                        <div class="form-group" style="position: relative;">
    <label>Institution / University</label>
    <input type="text" id="schoolSearch" placeholder="Start typing (e.g. University of Ghana...)" autocomplete="off">
    <div id="school-suggestions" class="suggestions-list" style="display: none; position: absolute; width: 100%; z-index: 1000; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; max-height: 200px; overflow-y: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"></div>
</div>
                        <div class="form-group">
                            <label>Faculty / School</label>
                            <input type="text" id="faculty" placeholder="e.g. Faculty of Physical Sciences">
                        </div>
                        <div class="form-group">
                            <label>Department</label>
                            <input type="text" id="department" placeholder="e.g. Computer Science">
                        </div>
                        <div class="form-group">
                            <label>Current Level</label>
                            <select id="level">
                                <option value="100">Level 100</option>
                                <option value="200">Level 200</option>
                                <option value="300">Level 300</option>
                                <option value="400">Level 400</option>
                                <option value="500">Level 500</option>
                                <option value="600">Level 600</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Financial Status</label>
                            <select id="financial">
                                <option value="Regular">Regular (Fee Paying)</option>
                                <option value="Scholarship">Scholarship / Bursary</option>
                                <option value="International">International Student</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Program of Study</label>
                            <input type="text" id="program" placeholder="e.g. BSc. Information Technology">
                        </div>
                        <div class="form-group">
                            <label>Academic Degree</label>
                            <select id="degree">
                                <option value="Diploma">Diploma</option>
                                <option value="Bachelor">Bachelor's Degree</option>
                                <option value="Master">Master's Degree</option>
                                <option value="PhD">PhD</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Year of Entry</label>
                            <input type="number" id="entry-year" placeholder="2024">
                        </div>
                        <div class="form-group">
                            <label>Expected Completion</label>
                            <input type="number" id="grad-year" placeholder="2028">
                        </div>
                    </div>

                    <div class="action-bar">
                        <div style="display: flex; gap: 15px;">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                            <button type="button" class="btn-primary" style="background: var(--card-bg); color: var(--text-color); border: 1px solid var(--border-color);" onclick="downloadPDF()">
                                <i class="fas fa-file-pdf"></i> Download Record
                            </button>
                        </div>
                        <span id="save-status" style="font-weight: 600; color: var(--primary-color);"></span>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <div id="cropper-modal">
        <div class="modal-content">
            <h3 style="color: #333; margin-bottom: 15px;">Adjust Profile Photo</h3>
            <div class="img-container">
                <img id="crop-target" style="max-width: 100%;">
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button onclick="closeCropper()" style="padding: 10px 20px; border: none; background: #e2e8f0; border-radius: 6px; cursor: pointer;">Cancel</button>
                <button onclick="saveCroppedImage()" style="padding: 10px 20px; border: none; background: #2563eb; color: white; border-radius: 6px; cursor: pointer; font-weight: bold;">Apply Photo</button>
            </div>
        </div>
    </div>

    <footer style="margin-top: 50px; text-align: center; color: var(--text-muted); padding: 20px; border-top: 1px solid var(--border-color); margin-left: 280px;">
        <p>&copy; 2026 National Student Portal. All Rights Reserved.</p>
        <div class="social-links" style="justify-content: center; margin-top: 10px;">
            <a href="#" style="font-size: 1.2rem; color: var(--text-muted);"><i class="fab fa-whatsapp"></i></a>
            <a href="#" style="font-size: 1.2rem; color: var(--text-muted);"><i class="fab fa-linkedin"></i></a>
        </div>
    </footer>

    <script src="theme.js"></script>
    <script>
        // --- 1. INITIALIZATION ---
        document.addEventListener("DOMContentLoaded", () => {
            // Load Profile Pic from LocalStorage
            const savedPic = localStorage.getItem("portal-avatar");
            if(savedPic) document.getElementById("profile-display").src = savedPic;

            // Load Text Data (Mock Data for now, would come from DB)
            const savedData = JSON.parse(localStorage.getItem("portal-profile-data"));
            if(savedData) {
                document.getElementById("faculty").value = savedData.faculty;
                document.getElementById("department").value = savedData.department;
                document.getElementById("program").value = savedData.program;
                document.getElementById("entry-year").value = savedData.entry;
            }
        });

        // --- 2. IMAGE CROPPER ---
        let cropper;
        const imgInput = document.getElementById('img-input');
        const cropTarget = document.getElementById('crop-target');
        const modal = document.getElementById('cropper-modal');

        imgInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    cropTarget.src = e.target.result;
                    modal.style.display = 'flex';
                    if(cropper) cropper.destroy();
                    cropper = new Cropper(cropTarget, { aspectRatio: 1, viewMode: 1 });
                };
                reader.readAsDataURL(file);
            }
        });

        function closeCropper() {
            modal.style.display = 'none';
            imgInput.value = ''; // Reset input
        }

        function saveCroppedImage() {
            const canvas = cropper.getCroppedCanvas({ width: 300, height: 300 });
            const croppedDataUrl = canvas.toDataURL(); // Get Base64
            
            // Update UI
            document.getElementById("profile-display").src = croppedDataUrl;
            
            // Save to Storage
            localStorage.setItem("portal-avatar", croppedDataUrl);
            
            closeCropper();
        }

        // --- 3. SAVE PROFILE DATA ---
        function saveProfile() {
            const msg = document.getElementById("save-status");
            const entry = parseInt(document.getElementById("entry-year").value);
            const grad = parseInt(document.getElementById("grad-year").value);

            // Validation
            if (grad <= entry) {
                alert("Completion year must be after entry year.");
                return;
            }

           const profileData = {
    institution: document.getElementById("schoolSearch").value, // <--- ADD THIS LINE
    faculty: document.getElementById("faculty").value,
    department: document.getElementById("department").value,
    program: document.getElementById("program").value,
    entry: entry,
    grad: grad
};

            localStorage.setItem("portal-profile-data", JSON.stringify(profileData));

            msg.innerText = "‚úì Changes Saved";
            msg.style.opacity = 1;
            setTimeout(() => { msg.style.opacity = 0; }, 3000);
        }

        // --- 4. PDF DOWNLOAD ---
        function downloadPDF() {
            const element = document.getElementById('printable-area');
            const opt = {
                margin: 10,
                filename: 'Academic_Profile.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }

        // --- 5. INSTITUTION SEARCH LOGIC ---
    const ghanaInstitutions = [
        "University of Ghana (UG)", "Kwame Nkrumah University of Science and Technology (KNUST)",
        "University of Cape Coast (UCC)", "University for Development Studies (UDS)",
        "University of Education, Winneba (UEW)", "Ghana Institute of Management and Public Administration (GIMPA)",
        "University of Professional Studies, Accra (UPSA)", "University of Mines and Technology (UMaT)",
        "University of Health and Allied Sciences (UHAS)", "University of Energy and Natural Resources (UENR)",
        "Ashesi University", "Central University", "Valley View University", "Pentecost University",
        "Accra Technical University (ATU)", "Kumasi Technical University (KsTU)", "Takoradi Technical University (TTU)",
        "Koforidua Technical University (KTU)", "Ho Technical University (HTU)", "Tamale Technical University (TaTU)",
        "Sunyani Technical University (STU)", "Cape Coast Technical University (CCTU)", "Bolgatanga Technical University",
        "Akenten Appiah-Menka University of Skills Training and Entrepreneurial Development (AAMUSTED)",
        "Ghana Communication Technology University (GCTU)", "All Nations University", "Regent University College"
    ];

    const schoolInput = document.getElementById('schoolSearch');
    const suggestionBox = document.getElementById('school-suggestions');

    schoolInput.addEventListener('input', function() {
        const val = this.value.toLowerCase();
        suggestionBox.innerHTML = '';
        
        if (!val) { 
            suggestionBox.style.display = 'none'; 
            return; 
        }

        const matches = ghanaInstitutions.filter(s => s.toLowerCase().includes(val));
        
        if (matches.length > 0) {
            suggestionBox.style.display = 'block';
            matches.forEach(match => {
                const div = document.createElement('div');
                div.style.padding = '12px';
                div.style.cursor = 'pointer';
                div.style.borderBottom = '1px solid var(--border-color)';
                // Hover effect logic handled by CSS or inline
                div.onmouseover = function() { this.style.background = 'var(--primary-color)'; this.style.color = 'white'; };
                div.onmouseout = function() { this.style.background = 'transparent'; this.style.color = 'var(--text-color)'; };
                
                div.innerHTML = match;
                div.onclick = () => {
                    schoolInput.value = match;
                    suggestionBox.style.display = 'none';
                };
                suggestionBox.appendChild(div);
            });
        } else {
            // Allow manual entry if not found
            suggestionBox.style.display = 'none';
        }
    });

    // Close dropdown on outside click
    document.addEventListener('click', function(e) {
        if (!schoolInput.contains(e.target)) {
            suggestionBox.style.display = 'none';
        }
    });

    </script>
</body>
</html>