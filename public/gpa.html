<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal GPA Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        .gpa-container {
            max-width: 900px;
            margin: 40px auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: grid;
            grid-template-columns: 2fr 1fr; /* Split: Calculator (Left) vs Table (Right) */
            gap: 30px;
        }

        /* Responsive: Stack them on mobile */
        @media (max-width: 768px) {
            .gpa-container { grid-template-columns: 1fr; }
        }

        .course-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        input, select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
        }

        .btn-add { background: #10b981; color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; }
        .btn-calc { background: #2563eb; color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 10px;}
        .btn-remove { background: #ef4444; color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer; }

        /* Reference Table Styles */
        .reference-box {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }
        
        .reference-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .reference-table th, .reference-table td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }

        .scale-selector {
            background: #e0f2fe;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #bae6fd;
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo">üéì Student Portal</div>
        <a href="/dashboard" style="color: var(--primary-color); font-weight: 600; text-decoration: none;">&larr; Back to Dashboard</a>
    </nav>

    <main class="gpa-container">
        
        <div class="calculator-section">
            <h1>GPA Calculator üìä</h1>
            
            <div class="scale-selector">
                <label style="font-weight: bold; display: block; margin-bottom: 5px;">Select Grading Scale:</label>
                <select id="scale-mode" onchange="updateReferenceTable()">
                    <option value="4.0">Standard 4.0 Scale</option>
                    <option value="5.0">Weighted 5.0 Scale</option>
                </select>
            </div>

            <form id="gpaForm">
                <div id="course-list">
                    <div class="course-row">
                        <input type="text" placeholder="Course Name" required>
                        <input type="number" class="credits" placeholder="Credits" min="1" required>
                        <select class="grade" required>
                            <option value="" disabled selected>Grade</option>
                            <option value="A+">A+</option>
                            <option value="A">A</option>
                            <option value="B+">B+</option>
                            <option value="B">B</option>
                            <option value="C+">C+</option>
                            <option value="C">C</option>
                            <option value="D+">D+</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                        </select>
                    </div>
                </div>

                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button type="button" class="btn-add" onclick="addRow()">+ Add Course</button>
                </div>
                <button type="submit" class="btn-calc">Calculate GPA</button>
            </form>

            <div id="result" style="display:none; margin-top: 20px; text-align: center;">
    <h3>Your GPA: <span id="gpaValue" style="color: #2563eb; font-size: 2.5rem;">0.00</span></h3>
    
    <button id="btn-save" onclick="saveGPA()" style="background: #0f172a; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px;">
        üíæ Save to Profile
    </button>
    <p id="save-msg" style="color: green; margin-top: 5px; display: none;">Saved!</p>
</div>

        <div class="reference-box">
            <h3>üìù Score Range Guide</h3>
            <p id="table-caption">Current Scale: <strong>4.0</strong></p>
            
            <table class="reference-table">
                <thead>
                    <tr>
                        <th>Score Range</th>
                        <th>Grade</th>
                        <th>Point</th>
                    </tr>
                </thead>
                <tbody id="grading-body">
                    </tbody>
            </table>
        </div>

    </main>

    <script src="theme.js"></script>
    <script>
        // --- 1. CONFIGURATION: Define the Two Scales ---
        const scales = {
            "4.0": [
                { grade: "A",  point: 4.00, range: "70 - 100%" },
                { grade: "B+", point: 3.50, range: "60 - 69%" },
                { grade: "B",  point: 3.00, range: "50 - 59%" },
                { grade: "C+", point: 2.50, range: "45 - 49%" },
                { grade: "C",  point: 2.00, range: "40 - 44%" },
                { grade: "F",  point: 0.00, range: "00 - 39%" },
            ],
            "5.0": [
                { grade: "A+", point: 5.00, range: "80 - 100%" },
                { grade: "A",  point: 4.50, range: "70 - 79%" },
                { grade: "B+", point: 4.00, range: "65 - 69%" },
                { grade: "B",  point: 3.50, range: "60 - 64%" },
                { grade: "C+", point: 3.00, range: "55 - 59%" },
                { grade: "C",  point: 2.50, range: "50 - 54%" },
                { grade: "D+", point: 2.00, range: "45 - 49%" },
                { grade: "D",  point: 1.50, range: "40 - 44%" },
                { grade: "E",  point: 1.00, range: "35 - 39%" },
                { grade: "F",  point: 0.00, range: "00 - 34%" } 
            ],
        };

        // --- 2. UPDATE TABLE FUNCTION ---
        function updateReferenceTable() {
            const mode = document.getElementById('scale-mode').value;
            const tableBody = document.getElementById('grading-body');
            const data = scales[mode];
            
            // Update caption
            document.getElementById('table-caption').innerHTML = `Current Scale: <strong>${mode}</strong>`;

            // Clear and rebuild table
            tableBody.innerHTML = "";
            data.forEach(item => {
                const row = `<tr>
                    <td>${item.range}</td>
                    <td><b>${item.grade}</b></td>
                    <td>${item.point.toFixed(1)}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }

        // --- 3. CALCULATE GPA LOGIC ---
        document.getElementById('gpaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const mode = document.getElementById('scale-mode').value;
            const currentScale = scales[mode]; // Get the list of points for this scale
            
            const creditInputs = document.querySelectorAll('.credits');
            const gradeInputs = document.querySelectorAll('.grade');
            
            let totalPoints = 0;
            let totalCredits = 0;

            for (let i = 0; i < creditInputs.length; i++) {
                const credits = parseFloat(creditInputs[i].value);
                const gradeLetter = gradeInputs[i].value;

                if (!credits || !gradeLetter) continue;

                // Find the point value for this letter in the selected scale
                const gradeData = currentScale.find(g => g.grade === gradeLetter);
                
                if (gradeData) {
                    totalPoints += (credits * gradeData.point);
                    totalCredits += credits;
                }
            }

            const finalGPA = totalCredits === 0 ? 0.00 : (totalPoints / totalCredits).toFixed(2);
            
            document.getElementById('result').style.display = 'block';
            document.getElementById('gpaValue').innerText = finalGPA;
        });

        // --- 4. ADD ROW FUNCTION ---
        function addRow() {
            const container = document.getElementById('course-list');
            const div = document.createElement('div');
            div.className = 'course-row';
            div.innerHTML = `
                <input type="text" placeholder="Course Name" required>
                <input type="number" class="credits" placeholder="Credits" min="1" required>
                <select class="grade" required>
                    <option value="" disabled selected>Grade</option>
                    <option value="A+">A+</option>
                    <option value="A">A</option>
                    <option value="B+">B+</option>
                    <option value="B">B</option>
                    <option value="C+">C+</option>
                    <option value="C">C</option>
                    <option value="D+">D+</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                </select>
                <button type="button" class="btn-remove" onclick="this.parentElement.remove()">üóëÔ∏è</button>
            `;
            container.appendChild(div);
        }

        // Initialize table on load
        updateReferenceTable();
        // --- 5. SAVE GPA FUNCTION ---
function saveGPA() {
    const gpaText = document.getElementById('gpaValue').innerText;
    const saveBtn = document.getElementById('btn-save');
    const msg = document.getElementById('save-msg');

    saveBtn.textContent = "Saving...";

    fetch('/api/save-gpa', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ gpa: gpaText })
    })
    .then(res => res.json())
    .then(data => {
        saveBtn.textContent = "‚úÖ Saved";
        saveBtn.disabled = true; // Prevent double clicking
        msg.style.display = 'block';
        msg.innerText = "Saved to your profile successfully!";
    })
    .catch(err => {
        console.error(err);
        saveBtn.textContent = "‚ùå Error";
    });
}

    </script>
</body>
</html>